{% load static %}

<div class="index-article-card">
    <h2>
        <a href="{% url 'article_page' article.slug %}">
            {{ article.title }}
        </a>
    </h2>
    
    <p class="byline">
        {% if article.authors.all|length > 2 %}
            By {% for author in article.authors.all %}
                <a href="{% url 'author' author.slug %}">
                    {% if forloop.last %} {{ author.name }}, {% else %} {{ author.name }} {% endif %}
                </a>
            {% endfor %} &bull;
        {% elif article.authors.all|length == 2 %}
            By <a href="{% url 'author' article.authors.all.0.slug %}">{{ article.authors.all.0.name }}</a> & <a href="{% url 'author' article.authors.all.1.slug %}">{{ article.authors.all.1.name }}</a> &bull;
        {% elif article.authors.all|length == 1 %}
            By <a href="{% url 'author' article.authors.all.0.slug %}">{{ article.authors.all.0.name }}</a> &bull;
        {% endif %}
        <a href="{% url 'issue' article.issue.vol article.issue.num %}">
            Vol {{ article.issue.vol }}, Issue {{ article.issue.num}}
        </a> &bull;
        {{article.true_created_on|date:"DATE_FORMAT"}}
    </p>

    {% load tag %}
    {% is_image_article article.body as x %}
    {% if x %}
        {% with vol=article.issue.vol|stringformat:"s" num=article.issue.num|stringformat:"s" %}
            {% with folder_path="vol"|add:vol|add:"/issue"|add:num|add:"/images/" %}
                {{ article.body|create_md|imgswitch:folder_path|safe }}
            {% endwith %}
        {% endwith %}
    {% else %}
        {{article.body | create_md | imgremove | truncatewords_html:50 | safe}}
    {% endif %}
    <p><a href="{% url 'article_page' article.slug %}">Read more</a></p>
</div>

<!--

    THE RTOSH PLAN:

    1. Fix markdown vs. imgswitch issue in tags
    2. Create separate mechanism for image-only articles
    3. Add image dimensions to articleimages model
    4. Improve image rendering (load images on demand, show properly-sized light gray placeholder until then)
    5. Improve rendering of image-only articles in all places they're shown (index cards [large, sidebar, and main], stories/staff cards, article page)

-->